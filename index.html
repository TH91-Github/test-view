<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <title>TEST ÌôîÎ©¥</title>
  <link rel="stylesheet" href="./assets/css/common.css">
</head>
<style>
html{
  border:1px solid blue;
  background:#fff;
}
body{
  border:1px solid red;
  background:gray;
}
.wrap {
  position:relative;
  max-width:750px;
  margin:0 auto;
  background:#FFF3CF;
}
.content{
  position:relative;
  height:auto;
  padding:30px;
}
.input-box {
  position:relative;
  z-index:11;
  margin-top:30px;
  text-align:center;
}
.input-box .input {
  padding:5px;
}
.title{
  font-size:1.125rem;
  text-align:center;
}
[class^="box-cont"]{
  position:relative;
  width:100%;
  height:500px;
  border:1px solid #000;
  text-align:center;
}
[class^="box-cont"] span {color:#fff;}
.box-cont1 {background:#40A2E3;}
.box-cont2 {background:#0D9276;}
.box-cont3 {background:#637A9F;}
.pos-bottom {
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
}
[class^="fixed-"]{
  position:fixed;
  right:0;
  padding:3px 5px;
  border-radius:5px;
  background:#242424;
  font-size:0.75rem;
  color:#fff;
}
.fixed-top {
  top:0;
}
.fixed-center{
  top:50%; 
  transform: translateY(-50%);
}
.fixed-bottom{
  bottom:0;
}
/* figure-wrap */
.figure-wrap {
  position:fixed;
  top:0;
  left:0;
  width:7.5rem;
  height:100%;
  background: rgb(0, 0, 0,.7);
  font-size:0.875rem;
  color:#FFBB64;
}
.figure-wrap .title {
  margin-bottom:10px; 
  font-size:1rem; 
  color:#fff;}
.figure-wrap span {
  font-size:0.75rem; 
  color:#fff;}
.figure-center {
  position:absolute; 
  top:50%; 
  left:50%; 
  width:100%; 
  padding:5px 3px; 
  border:1px solid red; 
  transform:translate(-50%, -50%); 
}
/* visual-viewport */
.visual-viewport{ 
  position:fixed;
  top:0;
  left:calc(7.5rem + 10px);
  width:7.5rem;
  height:100%;
  background:rgb(67, 104, 80,.7);
  font-size:0.875rem;
  /* transition: all .1s; */
}
.visual-viewport .title {
  position:absolute;
  top:200px;
  width:100%;
  color:#fff;
}
.visual-viewport > span {
  display:inline-block;
  position:absolute;
  left:50%;
  padding: 3px 5px;
  border-radius:5px;
  background:#12372A;
  font-size:0.75rem;
  color:#fff;
  text-align:center;
  transform:translateX(-50%);
}
.visual-viewport .top {
  top:0;
}
.visual-viewport .center {
  top:50%; 
  transform:translate(-50%,-50%);
}
.visual-viewport .bottom {
  bottom:0;
}

</style>
<body>
  <div class="wrap">
    <div class="content">
      <h1 class="title">IOS ÌÇ§Î≥¥Îìú ÌÖåÏä§Ìä∏</h1>
      <div class="input-box">
        <input type="text" class="input"/><br />
        <span>‚òùÔ∏è TEST Input</span>
      </div>
      <div class="box-cont1">
        <span>box-1 top</span>
        <span class="pos-bottom">box-1 bottom</span>
      </div>
      <div class="box-cont2">
        <span>box-2 top</span>
        <span class="pos-bottom">box-2 bottom</span>
      </div>
      <div class="box-cont3">
        <span>box-3 top</span>
        <span class="pos-bottom">box-3 bottom</span>
      </div>
    </div>
    <!-- Í≥†Ï†ï fixed ÏàòÏπò Ìëú üëâ ÌôîÎ©¥ ÏôºÏ™Ω -->
    <div class="figure-wrap">
      <div class="figure-center">
        <p class="title">position:fixed</p>
        <p class="window-scroll">w-scroll: <br /><span>0</span></p>
        <p class="visualviewport-scroll">viewport-scroll: <br /><span>0</span></p>
        <p class="viewOffsetTop">offsetTop: <span>0</span></p>
        <p class="viewPageTop">pageTop: <span>0</span></p>
        <p class="gapTop">gapTop <span>0</span></p>
        <p class="end-translate">translateY <span>0</span></p>
        <hr />
        <p class="body-height">body-H: <span>0</span></p>
        <p class="window-innerheight">window-H: <span>0</span></p>
        <p class="visualviewport-height">viewport-H: <span>0</span></p>
        <p class="difference-height">Í∞ÄÎ†§ÏßÑ ÌÇ§Î≥¥Îìú H: <span>0</span></p>
      </div>
    </div>
    <!-- viewport ÌÇ§Î≥¥Îìú Ïú†Î¨¥Ïóê Îî∞Îùº Î≥ÄÍ≤Ω üëâ ÌôîÎ©¥ Í∞ÄÏö¥Îç∞ -->
    <div class="visual-viewport">
      <p class="title">
        viewport <br />Box<br />
        ÌÇ§Î≥¥Îìú <span class="viewportText">Off</span>
      </p>
      <span class="top">viewport Top</span>
      <span class="center">viewport Center</span>
      <span class="bottom">viewport Bottom</span>
    </div>
    <!-- fixed ÎπÑÍµê top, center, bottom üëâ ÌôîÎ©¥ Ïò§Î•∏Ï™Ω -->
    <div class="label-fixed">
      <span class="fixed-top">fixed : Top</span>
      <span class="fixed-center">fixed : Center</span>
      <span class="fixed-bottom">fixed : Bottom</span>
    </div>
  </div>
</body>
</html>

<script>
const wrap = document.querySelector('.wrap');
// figure text 
const testTag = {
  windowScrollText : wrap.querySelector('.window-scroll span'),
  viewportScrollText: wrap.querySelector('.visualviewport-scroll span'),
  offsetTopText : wrap.querySelector('.viewOffsetTop span'),
  pageTopText : wrap.querySelector('.viewPageTop span'),
  gapTopText :wrap.querySelector('.gapTop span'),
  endTranslateText : wrap.querySelector('.end-translate span'),
  bodyHeightText : wrap.querySelector('.body-height span'),
  windowHeightText : wrap.querySelector('.window-innerheight span'),
  viewportHeightText : wrap.querySelector('.visualviewport-height span'),
  differenceHeightText : wrap.querySelector('.difference-height span'),
  keyboardOnOffText : wrap.querySelector('.viewportText'),
}
const figure = {
  bodyHeight : 0,
  windowInnerHeight : 0,
  viewportHeight : 0,
  differenceHeightNum : 0,
  gapTop : 0,
  translateY : 0,
  isKeyboard : false
}
// viewport box
const viewportwrap = document.querySelector('.visual-viewport');

function handleWindowScroll(e){
  figure.gapTop = parseInt(visualViewport.pageTop - visualViewport.offsetTop);
  viewportFixed();
}
// viewport scroll Ïä§ÌÅ¨Î°§ ÎÅùÎÇú ÌõÑ ÏßÑÌñâ
function handleViewportScroll (e){ 
  const viewportScrollY = parseInt(e.target.offsetTop);
  testTag.viewportScrollText.textContent = viewportScrollY;
  viewportFixed();
}

function viewportFixed(){
  testTag.offsetTopText.textContent = parseInt(visualViewport.offsetTop);
  testTag.pageTopText.textContent = parseInt(visualViewport.pageTop);
  testTag.gapTopText.textContent = Math.abs(figure.gapTop);
  
  if(window.scrollY < 0){ // 1 Î≥¥Îã§ ÏûëÏùÑ Îïå 0, -1 ~
    figure.translateY = 0;
  }
  // Í∞ÄÏÉÅ ÏòÅÏó≠ÍπåÏßÄ Ïä§ÌÅ¨Î°§ ÎÇ¥Î†§Í∞ÄÎäî Í≤ÉÏùÑ Î∞©ÏßÄ
  if(window.scrollY + figure.viewportHeight > figure.bodyHeight - 2){ 
    window.scrollTo(0, figure.bodyHeight - figure.viewportHeight-1);
  }
  figure.translateY = parseInt(window.scrollY - figure.gapTop);
  testTag.windowScrollText.textContent = parseInt(window.scrollY); // Ïä§ÌÅ¨Î°§
  testTag.endTranslateText.textContent = figure.translateY; 
  viewportwrap.style.transform = `translateY(${figure.translateY}px)`;
}

// Resize
function viewportResize () {
  figure.bodyHeight = document.body.offsetHeight; // body height 
  figure.windowInnerHeight = window.innerHeight; // window height
  figure.viewportHeight = parseInt(visualViewport.height); // viewport height
  figure.differenceHeightNum = figure.windowInnerHeight - figure.viewportHeight; // Í∞ÄÎ†§ÏßÑ ÌÇ§Î≥¥Îìú ÏòÅÏó≠

  // figure ÏûÖÎ†•
  testTag.bodyHeightText.textContent = figure.bodyHeight;
  testTag.windowHeightText.textContent = figure.windowInnerHeight;
  testTag.viewportHeightText.textContent = figure.viewportHeight;
  testTag.differenceHeightText.textContent = figure.differenceHeightNum;
 
  // ÌÇ§Ìå®Îìú Ï†ÑÏ≤¥ ÌôîÎ©¥ ÎÜíÏù¥Î≥¥Îã§ viewport ÎÜíÏù¥Í∞Ä ÏûëÏùÑ Îïå
  if(figure.windowInnerHeight > figure.viewportHeight){ // ÌÇ§Î≥¥Îìú ON
    figure.isKeyboard = true;
    testTag.keyboardOnOffText.textContent = 'On';
    viewportwrap.style.height = `${figure.viewportHeight}px`;
    window.addEventListener('scroll',handleWindowScroll);
    visualViewport.addEventListener("scroll", handleViewportScroll);
  }else{  // ÌÇ§Î≥¥Îìú OFF
    figure.isKeyboard = false;
    testTag.keyboardOnOffText.textContent = 'Off';
    viewportwrap.style.height = "100%";
    window.removeEventListener('scroll',handleWindowScroll);
    visualViewport.removeEventListener("scroll", handleViewportScroll);
  }
}
visualViewport.addEventListener('resize',viewportResize);



</script>
